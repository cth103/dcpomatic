<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE book [
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % dbcent PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN"
   "/usr/share/xml/docbook/schema/dtd/4.5/dbcentx.mod">
%dbcent;
<!ENTITY % extensions SYSTEM "extensions.ent">
%extensions;
]>
<book xmlns="http://docbook.org/ns/docbook" xmlns:mml="http://www.w3.org/1998/Math/MathML" version="5.0" xml:lang="en">

<bookinfo>
<title>DCP-o-matic users' manual</title>
<author><firstname>Carl</firstname><surname>Hetherington</surname></author>
</bookinfo>

<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>Introduction</title>

<para>
Hello, and welcome to DCP-o-matic!
</para>

<!-- ============================================================== -->
<section>
<title>What is DCP-o-matic?</title>

<para>
DCP-o-matic is a program to generate <ulink
url="http://en.wikipedia.org/wiki/Digital_Cinema_Package">Digital
Cinema Packages</ulink> (DCPs) from almost any video, audio and/or
subtitle source files.  The resulting DCPs will play on modern digital
cinema projectors.
</para>

</section>


<!-- ============================================================== -->
<section>
<title>Licence</title>

<para>
DCP-o-matic is free and open-source and is licensed under the <ulink
url="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">GNU
GPL</ulink>.
</para>

</section>


<!-- ============================================================== -->
<section>
<title>Acknowledgements</title>

<para>
This manual uses icons from the <ulink url="http://tango.freedesktop.org/">Tango Desktop Project</ulink>, with thanks.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>This manual</title>

<para>
This manual presents bits of DCP-o-matic's user interface (such as menu items or buttons) <guilabel>like this</guilabel>.
</para>

<note>
Notes of an advanced nature are presented like this.  Ignore them unless you want to know the gory details.
</note>

</section>
</chapter>


<!-- ============================================================== -->
<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>Installation</title>


<!-- ============================================================== -->
<section>
<title>Windows</title>

<para>
To install DCP-o-matic on Windows, download the installer from
<ulink url="http://dcpomatic.com/">http://dcpomatic.com/</ulink>
and double-click it.  Click through the installer wizard, and
DCP-o-matic will be installed onto your machine.
</para>

<para>
If you are using a 32-bit version of Windows, you will need the 32-bit
installer.  For 64-bit Windows, either installer will work, but I
suggest you used the 64-bit version as it will allow DCP-o-matic to
use more memory.  You may find that DCP-o-matic crashes if you run
many parallel encoding threads (more than 4) on the 32-bit
version.
</para>

<para>
If you are still using Windows XP, download the specific XP version as
it should be more stable on your machine than the &lsquo;normal&rsquo;
Windows version.
</para>

</section>


<!-- ============================================================== -->
<section>
<title>Mac OS X</title>

<para>
DCP-o-matic will run on Mac OS X version 10.6 (Snow Leopard) and
higher.  To install it, download the <code>.dmg</code> from <ulink
url="http://dcpomatic.com/">http://dcpomatic.com/</ulink> and double
click to open it.  Then drag the DCP-o-matics icon to your
<guilabel>Applications</guilabel> folder or wherever else you would
like to install it.
</para>

<para>
You do not have to install all the applications, but you must always
install <code>DCP-o-matic 2.app</code> as the other applications
depend on it.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Debian or Ubuntu Linux</title>

<para>
  You can install DCP-o-matic on:
</para>

<itemizedlist>
  <listitem>Debian 7 (&lsquo;wheezy&rsquo;)</listitem>
  <listitem>Debian 8 (&lsquo;jessie&rsquo;)</listitem>
  <listitem>Debian unstable (&lsquo;sid&rsquo;)</listitem>
  <listitem>Ubuntu 12.04 (&lsquo;Precise Pangolin&rsquo;)</listitem>
  <listitem>Ubuntu 14.04 (&lsquo;Trusty Tahr&rsquo;)</listitem>
  <listitem>Ubuntu 16.04 (&lsquo;Xenial Xerus&rsquo;)</listitem>
</itemizedlist>

<para>
using <code>.deb</code> packages: download the appropriate package
from <ulink url="http://dcpomatic.com/">http://dcpomatic.com/</ulink>
and double-click it.  Debian or Ubuntu will install the necessary bits and
pieces and set DCP-o-matic up for you.
</para>
</section>
<!-- ============================================================== -->


<!-- ============================================================== -->
<section>
  <title>Fedora Linux</title>

  <para>There are <code>.rpm</code> packages for Fedora 22 and 23 on
  <ulink url="http://dcpomatic.com/">http://dcpomatic.com/</ulink>
  </para>
</section>
<!-- ============================================================== -->


<!-- ============================================================== -->
<section>
  <title>Centos Linux</title>
  <para>There are <code>.rpm</code> packages for Centos 5, 6.5 and 7 on
  <ulink url="http://dcpomatic.com/">http://dcpomatic.com/</ulink>
  </para>
</section>
<!-- ============================================================== -->


<!-- ============================================================== -->
<section>
<title>Arch Linux</title>
<para>
Packages for Arch Linux are available from <ulink
url="https://aur.archlinux.org/packages/dcpomatic/">https://aur.archlinux.org/packages/dcpomatic/</ulink>,
thanks to Stefan Karner.
</para>
</section>


<!-- ============================================================== -->
<section>
<title>Other Linux distributions</title>

<para>
Installation on other Linux systems (for which no packages are
available) is quite hard as it must be compiled from source.  If you
can't download packages for your distribution, do let me know by
<ulink url="mailto:carl@dcpomatic.com">email</ulink> and I will look
into providing packages on the website.
</para>

<para>
The following dependencies are required:
<itemizedlist>
<listitem><ulink url="http://ffmpeg.org/">FFmpeg</ulink></listitem>
<listitem><ulink url="http://www.mega-nerd.com/libsndfile/">libsndfile</ulink></listitem>
<listitem><ulink url="http://www.mega-nerd.com/SRC/">libsamplerate</ulink></listitem>
<listitem><ulink url="http://www.openssl.org/">OpenSSL</ulink></listitem>
<listitem><ulink url="http://www.openjpeg.org/">libopenjpeg</ulink></listitem>
<listitem><ulink url="http://www.imagemagick.org/script/index.php">ImageMagick</ulink></listitem>
<listitem><ulink url="http://www.boost.org/">Boost</ulink></listitem>
<listitem><ulink url="http://www.libssh.org/">libssh</ulink></listitem>
<listitem><ulink url="http://www.gtk.org/">GTK (on Linux)</ulink></listitem>
<listitem><ulink url="http://www.wxwidgets.org/">wxWidgets</ulink></listitem>
<listitem><ulink url="http://libxmlplusplus.sourceforge.net/">libxml++</ulink></listitem>
<listitem><ulink url="http://www.aleksey.com/xmlsec/">xmlsec</ulink></listitem>
<listitem><ulink url="http://curl.haxx.se/">curl</ulink></listitem>
<listitem><ulink url="http://www.nih.at/libzip/">libzip</ulink></listitem>
<listitem><ulink url="http://carlh.net/libdcp/">libdcp</ulink></listitem>
<listitem><ulink url="http://carlh.net/libsub/">libsub</ulink></listitem>
<listitem><ulink url="http://carlh.net/libcxml/">libcxml</ulink></listitem>
<listitem><ulink url="http://site.icu-project.org">libicu</ulink></listitem>
</itemizedlist>
</para>

<para>
Once you have installed the development packages for the dependencies,
download the source code from <ulink
url="http://dcpomatic.com/">http://dcpomatic.com/</ulink>,
unpack it and run the following commands from inside the source
directory:
</para>

<programlisting>
./waf configure
./waf build
sudo ./waf install
</programlisting>

<para>
With any luck, this will build and install DCP-o-matic on your system.  To run it, enter:
</para>

<programlisting>
dcpomatic2
</programlisting>

<para>
in a shell.
</para>

</section>
</chapter>


<!-- ============================================================== -->
<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>Creating a DCP from a video</title>

<para>
In this chapter we will see how to create a DCP from a video file using
DCP-o-matic.  We will gloss over the details and look at the basics.
</para>

<section>
<title>Creating a new film</title>

<para>
Let's make a very simple DCP to see how DCP-o-matic works.  First, we
need some content.  Download the low-resolution trailer for the open
movie <ulink url="http://sintel.org/">Sintel</ulink> from <ulink
url="http://ftp.nluug.nl/ftp/graphics/blender/apricot/trailer/Sintel_Trailer1.480p.DivX_Plus_HD.mkv">their
website</ulink>.  Generally one would want to use the
highest-resolution material available, but for this test we will use
the low-resolution version to save everyone's bandwidth bills.
</para>

<para>
Now, start DCP-o-matic and its window will open.  First, we will
create a new &lsquo;film&rsquo;.  A &lsquo;film&rsquo; is how DCP-o-matic refers to
some pieces of content, along with some settings, which we will make into
a DCP.  DCP-o-matic stores its data in a folder on your disk while it
creates the DCP.  You can create a new film by selecting
<guilabel>New</guilabel> from the <guilabel>File</guilabel> menu, as
shown in <xref linkend="fig-file-new"/>.
</para>

<figure id="fig-file-new">
  <title>Creating a new film</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/file-new&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
This will open a dialogue box for the new film, as shown in <xref
linkend="fig-video-new-film"/>.
</para>

<figure id="fig-video-new-film">
  <title>Dialogue box for creating a new film</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/video-new-film&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
In this dialogue box you can choose a name for the film.  This will be
used to name the folder to store its data in, and also as the initial
name for the DCP itself.  You can also choose whereabouts you want to create
the film.  In the example from the figure, DCP-o-matic will create a
folder called &lsquo;DCP Test&rsquo; inside my home folder (carl) into which it
will write its working files.
</para>

</section>


<!-- ============================================================== -->
<section>
<title>Adding content</title>

<para>
The next step is to add the content that you want to use.  DCP-o-matic
can make DCPs from multiple pieces of content, but in this simple
example we will just use a single piece.  Click the <guilabel>Add
file(s)...</guilabel> button, as shown in <xref
linkend="fig-add-file"/>, and a file chooser will open for you to
select the content file to use, as shown in <xref
linkend="fig-video-select-content-file"/>.
</para>

<figure id="fig-add-file">
  <title>Adding content files</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/add-file&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<figure id="fig-video-select-content-file">
  <title>Selecting a video content file</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/video-select-content-file&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
Select your content file and click <guilabel>Open</guilabel>.  In this
case we are using the Sintel trailer that we downloaded earlier.
</para>

<para>
When you do this, DCP-o-matic will take a look at your file.  After a
short while (when the progress bar at the bottom right of the window
has finished), you can look through your content using the slider to
the right of the window, as shown in <xref linkend="fig-examine-content"/>.
</para>

<figure id="fig-examine-content">
  <title>Examining the content</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/examine-content&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
Dragging the slider will move through your video.  You can also click
the <guilabel>Play</guilabel> button to play the content back.  <emphasis>Note
that there will be no sound</emphasis>, and playback might not be entirely
accurate (it may be slightly slower or faster than it should be, for
example).  This player is really only intended for brief inspection of
content; if you need to check it more thoroughly, use another player
such as <ulink
url="http://projects.gnome.org/totem/index.html">Totem</ulink>, <ulink
url="http://www.mplayerhq.hu/design7/news.html">mplayer</ulink> or
<ulink url="http://www.videolan.org/vlc/index.html">VLC</ulink>.
</para>

</section>




<!-- ============================================================== -->
<section>
<title>Making the DCP</title>

<para>In most cases, some adjustments would be made to DCP-o-matic's
settings once the content has been added.  For our simple test,
however, the default values will suffice, so we can go straight onto
making the DCP.</para>

<para>
Choose <guilabel>Make DCP</guilabel> from the
<guilabel>Jobs</guilabel> menu.  DCP-o-matic will encode your DCP.
This may take some time (many hours in some cases).  While the job is
in progress, DCP-o-matic will update you on how it is getting on with
the progress bar in the bottom of its window, as shown in <xref
linkend="fig-making-dcp"/>.
</para>

<figure id="fig-making-dcp">
  <title>Making the DCP</title>
  <mediaobject>
    <imageobject>
      <imagedata scale="50" fileref="screenshots/making-dcp&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
When it has finished, the DCP will end up on your disk inside the
film's folder.  You can then copy this to a projector via a USB
stick, hard-drive or network connection.  See <xref
linkend="ch-files"/> for details about the files that DCP-o-matic creates.
</para>

<para>
Alternatively, if you have a projector or Theatre Management System
(TMS) that is accessible via SCP or FTP across your network, you can upload
the content directly from DCP-o-matic.  See the <xref
linkend="sec-prefs-tms" endterm="sec-prefs-tms-short"/> in <xref linkend="sec-prefs-tms"/>.
</para>

</section>
</chapter>


<!-- ============================================================== -->
<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>Creating a DCP from a still image</title>

<para>
DCP-o-matic can also be used to create DCPs of one or more still images, perhaps
for an advertisement or an on-screen announcement.  This chapter shows you
how to do it.
</para>

<para>
As with DCPs made from video files, the first step is to create a new
&lsquo;Film&rsquo;; select <guilabel>New</guilabel> from the
<guilabel>File</guilabel> menu and the new film dialogue will open as
shown in <xref linkend="fig-still-new-film"/>.
</para>

<figure id="fig-still-new-film">
  <title>Dialogue box for creating a new film</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/still-new-film&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
Enter a name and click <guilabel>OK</guilabel>.  Now we need to add
the content.  As before, click <guilabel>Add file(s)...</guilabel>.
For our example, we will add a single image file, as shown in <xref
linkend="fig-still-select-content-file"/>.
</para>

<figure id="fig-still-select-content-file">
  <title>Selecting a still content file</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/still-select-content-file&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
Most of the default settings will be fine for a simple test.  The one
thing that you might wish to change is the length of the still.
Select the <guilabel>Timing</guilabel> tab and you will see a
<guilabel>Play length</guilabel> setting, as shown in <xref
linkend="fig-timing-tab"/>.
</para>

<figure id="fig-timing-tab">
  <title>The timing tab</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/timing-tab&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
This length is a &lsquo;timecode&rsquo;: it consists of four numbers.
The first is hours, the second minutes, the third seconds, and the
fourth frames.  Enter the duration that you want and then click <guilabel>Set</guilabel>.
</para>

<para>
Finally, as with video, you can choose <guilabel>Make DCP</guilabel>
from the <guilabel>Jobs</guilabel> menu to create your DCP.  This will
be much quicker than creating a DCP from a video file, as DCP-o-matic only needs
to encode a single frame which it can then repeat.
</para>

</chapter>


<!-- ============================================================== -->
<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>Manipulating existing DCPs</title>

<para>
Frequently DCP-o-matic is used to take content in formats such as MP4
and convert it to JPEG2000 for a DCP.  It can also be used
to take existing DCPs and modify them in various ways.
</para>

<section>
<title>Importing a DCP into DCP-o-matic</title>

<para>
If you want to do something to an existing DCP the first step is to
import it.  Click <guilabel>Add folder...</guilabel> and select your
DCP's folder.  It will be added to the DCP-o-matic project.  If the
DCP is unencrypted you can preview it in the normal way, though
playback will be very slow as decoding of DCPs is almost as
computationally intensive as encoding them.
</para>

<para>
If your DCP is a Version File (VF), in other words it refers to
another DCP's assets, you should import it as follows:
</para>

<itemizedlist>
<listitem>Use <guilabel>Add folder...</guilabel> to import the VF DCP.
The VF DCP will be added to the content list and marked &ldquo;NEEDS
OV&rdquo;.</listitem>
<listitem>Right-click on the VF DCP in the content list and choose <guilabel>Add OV...</guilabel> from the menu.</listitem>
<listitem>Choose the folder that contains the OV DCP.  The VF will now be playable as normal.</listitem>
</itemizedlist>

</section>


<section>
<title>Decrypting encrypted DCPs</title>

<para>
DCPs can be encrypted (see <xref linkend="ch-encryption"/> for
details).  If you import an encrypted DCP you will need a key, in the
form of a Key Delivery Message (KDM), to decrypt it.
</para>

<para>
KDMs must be prepared by the organisation which created the DCP.  They
contain the keys to decrypt the DCP wrapped up in such a way that only
the intended recipient can read them.  You will need to provide the
organisation with a certificate which identifies your copy of
DCP-o-matic and allows them to create a KDM for you.
</para>

<para>
To get DCP-o-matic's decryption certificate, open the Preferences
dialogue (see <xref linkend="ch-preferences"/>) and go to the
<guilabel>Keys</guilabel> tab.  Click the <guilabel>Export DCP
decryption certificate...</guilabel> button at the bottom of this tab
and save the certificate.  Send this certificate to the DCP creators
and they can create a KDM to allow DCP-o-matic to decrypt their DCP.
</para>

<para>
Once you have your KDM, right-click the DCP's name in DCP-o-matic and
choose <guilabel>Add KDM...</guilabel>.  Specify your KDM and (all
being well) the DCP will be decrypted and become available for preview.
</para>

</section>


<section>
<title>Making a DCP from a DCP</title>

<para>
In many ways, using DCPs as <emphasis>content</emphasis> in
DCP-o-matic is the same as using any other content.  There are a few
things to note, though.
</para>


<section>
<title>Re-use of existing data</title>

<para>
Where possible DCP-o-matic will re-use existing JPEG2000-compressed
data from DCP content without modification.  This has the advantage
that creation of the new DCP will be quick, as the time-consuming
JPEG2000 encoding is not necessary.
</para>

<para>
DCP-o-matic can do this if you <emphasis>avoid</emphasis> changes to
the following content settings:
</para>

<itemizedlist>
<listitem>Crop</listitem>
<listitem>Scaling</listitem>
<listitem>Subtitle burn-in</listitem>
<listitem>Fades</listitem>
<listitem>Colour conversion</listitem>
</itemizedlist>

<para>
If you do change any of these settings on a piece of DCP content
DCP-o-matic will decode and then re-encode the JPEG2000 data.
</para>

</section>


<section xml:id="sec-overlay">
<title>Making overlay files</title>

<para>
With its default settings, DCP-o-matic will take any data from DCP
content and copy it into the DCP that it creates.  See <xref linkend="fig-dcp-copy"/>.
</para>

<figure id="fig-dcp-copy">
<title>Creating a new DCP by copying an existing one</title>
<mediaobject><imageobject><imagedata scale="100" fileref="diagrams/dcp-copy&dia;"/></imageobject></mediaobject>
</figure>

<para>
This can be inefficient in some cases.  Consider, for example, a film
which has ten different translations for which the subtitles are
different but video and audio are the same.  If the video and audio
content takes up, say, 100Gb this means that the set of DCPs for every
translation would be about 1Tb with a lot of duplicated data.
</para>

<para>
The DCP format has a solution to this problem.  One DCP can refer to
the &lsquo;assets&rsquo; (picture, sound or subtitle) of another DCP.
For our translation example this means that we could have a
&lsquo;base&rsquo; DCP (often called the OV or Original Version)
containing video, audio and one set of subtitles and then any number
of overlay DCPs (often called VF or Version Files) which refer to the
base version and replace the original subtitles with their own.  <xref
linkend="fig-dcp-refer"/> shows this principle for one of our
translations.  The DCP that we make refers to the original content
DCP's video and audio rather than containing a copy.
</para>

<figure id="fig-dcp-refer">
<title>Creating a new DCP by referring to an existing one</title>
<mediaobject><imageobject><imagedata scale="100" fileref="diagrams/dcp-refer&dia;"/></imageobject></mediaobject>
</figure>

<para>
To play back the subtitled DCP the projectionist ingests both the base
(OV) DCP and the overlay (VF) DCP, then plays the VF one.
</para>

<para>
To make a DCP like this:
</para>

<itemizedlist>
<listitem>Import your &lsquo;Content DCP&rsquo; to a DCP-o-matic project.</listitem>
<listitem>Add whatever replacement you want in your new DCP (replacement subtitles or audio files, for example).</listitem>
<listitem>Select the DCP in the content list</listitem>
<listitem>Tick the <guilabel>Refer to existing DCP</guilabel> checkbox
in the tabs for the parts of the DCP that you want to refer to in your
new DCP.  For example, to refer to the Content DCP's video and audio you would select the <guilabel>Video</guilabel> tab, click <guilabel>Refer to existing DCP</guilabel> then select the <guilabel>Audio</guilabel> tab and do the same.</listitem>
<listitem>Do <guilabel>Make DCP</guilabel> as usual and your VF DCP will be created.</listitem>
</itemizedlist>

</section>

</section>



</chapter>
<!-- ============================================================== -->


<!-- ============================================================== -->
<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>Content settings</title>

<para>
The previous chapters showed DCP generation using the default
settings.  DCP-o-matic offers a range of features to adjust the
content that goes into your DCP, and this chapter describes those
features in detail.
</para>

<section>
<title>Adding and removing content</title>

<para>
At the top of the <guilabel>Content</guilabel> tab is a list of the
content that will go into our DCP.  There can be as many pieces of
content as you like, and they can be of the following types:
</para>

<itemizedlist>
<listitem>Movie &mdash; a file containing some video, probably some
audio and possibly some embedded subtitles; for example, a MOV, MP4 or VOB.
</listitem>

<listitem>Sound &mdash; a file containing one or more channels of
audio; for example, a WAV or AIFF file.
</listitem>

<listitem>Still image &mdash; a file containing a single still image; for
example, a JPEG, PNG or TIFF file.
</listitem>

<listitem>Moving image &mdash; a directory containing many still
images which should be treated as the frames of a video.
</listitem>

<listitem>Subtitle &mdash; a file containing subtitle which will be
superimposed on the image of the DCP.  These can be
<guilabel>.srt</guilabel>, <guilabel>.ssa</guilabel>, <guilabel>.ass</guilabel> or <guilabel>.xml</guilabel>
files.</listitem>

<listitem>DCP &mdash; an existing DCP.</listitem>
</itemizedlist>

<para>
To add one or more movie, sound, still-image or subtitle files, select
<guilabel>Add file(s)...</guilabel> and choose them from the selector.
</para>

<para>
To add a directory (folder) of images or a DCP, choose <guilabel>Add
folder...</guilabel> and choose the directory from the selector.  If
you select a folder of images DCP-o-matic will open a small dialogue
box where you can enter the frame rate that the image sequence should
be run at.
</para>

<para>
You can remove a piece of content by clicking on its name and then
clicking the <guilabel>Remove</guilabel> button.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Adding existing DCPs</title>

<para>Adding existing DCPs to a DCP-o-matic film is a little different
to adding other types of content.  Most content has to be converted to
JPEG2000, the compression scheme used by DCPs, which is a very
time-consuming process.  Existing DCPs are already in JPEG2000 format
so do not require conversion.  This means that, provided no settings
such as crop are used on the DCP content, picture and sound data will
be passed from existing to new DCP unaltered.
</para>

<para>Encrypted DCPs that are added as content will require a KDM
targeted at DCP-o-matic so that DCP-o-matic can decrypt them.  You
should ask the creator of the imported DCP to provide a KDM for
DCP-o-matic's decryption certificate, which can be obtained by
clicking <guilabel>Export DCP decryption certificate...</guilabel>
from the <guilabel>Keys</guilabel> tab of the
<guilabel>Preferences</guilabel> dialog (see <xref
linkend="sec-prefs-keys"/>).
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Content Properties</title>

<para>
Below the content list are the controls to set content properties.  To
adjust the properties for a piece of content, click its name in the
content list.  The content property controls will then become active
for that piece of content.
</para>

<para>
If you want to change the properties for multiple pieces of content at
the same time, select the content in the list by clicking the first
piece then clicking the other pieces with <keycap>shift</keycap> key
held down.  Note that not all settings can be changed in this way.
</para>

<para>
The content properties are split up into four sections:
<guilabel>Video</guilabel>, <guilabel>Audio</guilabel>,
<guilabel>Subtitles</guilabel> and <guilabel>Timing</guilabel>.  Not
all of these sections will be active for all content types.  The controls
in each section are described below.
</para>

</section>


<!-- ============================================================== -->
<section>
<title>Video</title>

<para>
The <guilabel>Video</guilabel> tab controls properties of the image, as shown in <xref linkend="fig-video-tab"/>.
</para>

<figure id="fig-video-tab">
  <title>Video settings tab</title>
  <mediaobject>
    <imageobject>
       <imagedata fileref="screenshots/video-tab&scs;"/>
    </imageobject>
  </mediaobject>
</figure>


<!-- ============================================================== -->
<section>
<title>Refer to existing DCP</title>

<para>
This option is only applicable if the selected content is an existing
DCP.  It allows you to get the video content from the existing DCP by
referencing it (rather than copying).  See <xref
linkend="sec-overlay"/>.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Image type</title>

<para>
The next option on this tab is the &lsquo;type&rsquo; of the video.
This specifies how DCP-o-matic should interpret the video's image.
<guilabel>2D</guilabel> is the default; this just takes the video
image as a standard 2D frame.  The <guilabel>3D
left/right</guilabel> option tells DCP-o-matic to interpret the frame as a
left-right pair, as shown in <xref linkend="fig-3d-left-right"/>.
</para>

<figure id="fig-3d-left-right">
  <title>3D left/right image type</title>
  <mediaobject>
    <imageobject>
       <imagedata scale="100" fileref="diagrams/3d-left-right&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
Alternatively the <guilabel>3D top/bottom</guilabel> option tells
DCP-o-matic to see the frame as a top-bottom pair, as shown in <xref
linkend="fig-3d-top-bottom"/>.
</para>

<figure id="fig-3d-top-bottom">
  <title>3D top/bottom image type</title>
  <mediaobject>
    <imageobject>
       <imagedata scale="100" fileref="diagrams/3d-top-bottom&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
Another option is <guilabel>3D alternate</guilabel> which takes the
first frame of the content as for the left eye, the second for the
right eye, the third for the left, and so on.  Finally, you can
specify <guilabel>3D left only</guilabel> or <guilabel>3D right
only</guilabel> if this content contains only the the left or right
eye images.  This is useful when you have the left and right eye image
sets in different files; you can specify one content as <guilabel>3D
left only</guilabel> and another as <guilabel>3D right only</guilabel>
and DCP-o-matic will pick up the appropriate frames from each.
</para>

</section>


<!-- ============================================================== -->
<section>
<title>Filtering</title>

<para>
The &lsquo;filters&rsquo; settings allow you to apply various video
filters to the image.  These may be useful to try to improve
poor-quality sources like DVDs.  You can set up the filters by clicking the
<guilabel>Edit</guilabel> button next to the filters entry in the
setup area of the DCP-o-matic window; this opens the filters selector
as shown in <xref linkend="fig-filters"/>.
</para>

<figure id="fig-filters">
  <title>Filters selector</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/filters&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
After changing the filters setup, you will need to regenerate the DCP
to see the effect on the cinema screen.  The preview in DCP-o-matic
will update itself whenever filters are changed, though of course this
image is much smaller and of lower resolution than a projected image!
</para>
</section>



<!-- ============================================================== -->
<section>
<title>Colour conversion</title>

<para>
The <guilabel>Colour conversion</guilabel> setting specifies what
colour transforms and gamma correction DCP-o-matic will use when
converting the selected content into the XYZ colourspace for the DCP.
</para>

<para>
The easiest way to select the required conversion is to choose one of
DCP-o-matic's presets.  DCP-o-matic knows how to convert from four
common colourspaces: sRGB, Rec. 601, Rec. 709 and P3.  If you do not
know which preset you should use, refer to the suggestions in <xref
linkend="tab-colour-conversion"/>.
</para>

<table id="tab-colour-conversion">
<title>Suggested colour conversion settings</title>
<tgroup cols='2' align='left' colsep='1' rowsep='1'>
<colspec colwidth='1*'/>
<colspec colwidth='5*'/>
<tbody>
<row>
<entry>sRGB</entry><entry>Still images in RGB, e.g. photographs</entry>.
</row>
<row>
<entry>Rec. 601</entry><entry>Standard-definition content (fewer than about 1000 pixels across) including DVD rips.</entry>
</row>
<row>
<entry>Rec. 709</entry><entry>High-definition content including Blu-Ray rips.</entry>
</row>
<row>
<entry>P3</entry><entry>Content explicitly graded to P3.</entry>
</row>
</tbody>
</tgroup>
</table>

<para>
For other required colour conversions, and if you know what you are
doing, you can choose <guilabel>Custom</guilabel> which will open the full
colour conversion editing dialogue box:
</para>

<figure id="fig-colour-conversion">
  <title>Dialogue box for custom colour conversion</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/colour-conversion&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
Alternatively, choose <guilabel>None</guilabel> if your source files
are already in the XYZ colour space and require no conversion.
</para>

<para>
DCP-o-matic's colour conversion processes are discussed in much more
detail in a separate document <ulink
url="http://dcpomatic.com/manual/colour.pdf">colour.pdf</ulink>.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Other settings</title>

<para>
The <guilabel>crop</guilabel> settings can be used to crop your content,
which can be used to remove black borders from round the edges of DVD
images, for example.  The specified number of pixels will be trimmed
from each edge, and the content image in the right of the window will
be updated to show the effect of the crop.
</para>

<para>
The <guilabel>fade in</guilabel> and <guilabel>fade out</guilabel>
settings can be used to apply linear fades into and out of a piece of
content.  Specify the time for each, clicking <guilabel>Set</guilabel>
after making any changes.
</para>

<para>
The <guilabel>Scale to</guilabel> option governs the shape that
DCP-o-matic will scale the content's image into.  Select the aspect
ratio that your content should be presented in.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Video description</title>

<para>
At the bottom of the video tab is a short description of what will
happen to your video with the current settings.  In the example of
<xref linkend="fig-video-tab"/>, DCP-o-matic is telling you that the
video file is 1920x1080 pixels and it has square pixels (a pixel
aspect ratio of 1.00) hence its display aspect ratio is 1.78:1.  Since
the controls specify &lsquo;16.9&rsquo; for the ratio, DCP-o-matic
does not scale the image but pads it to the DCP's container ratio of
1.85:1.  For a 2K DCP this is 1998x1080 pixels.
</para>

<para>
This description also gives the frame rate of the content and what
will happen to it when it is played at the DCP's frame rate.  See
<xref linkend="ch-frame-rates"/> for details of DCP-o-matic's
frame-rate conversion.
</para>

</section>

</section>


<!-- ============================================================== -->
<section>
<title>Audio</title>

<para>
The <guilabel>Audio</guilabel> tab controls properties of the image, as shown in <xref linkend="fig-audio-tab"/>.
</para>

<figure id="fig-audio-tab">
  <title>Audio settings tab</title>
  <mediaobject>
    <imageobject>
       <imagedata fileref="screenshots/audio-tab&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<!-- ============================================================== -->
<section>
<title>The audio map</title>

<para>
The section at the bottom of the audio tab is the &lsquo;audio
map&rsquo;.  This governs how sound from the content will be arranged
in the DCP.
</para>

<para>
Down the left-hand side of the map is the list of audio channels in
the currently-selected piece of content.  These are labelled with two
numbers; the first is the stream index within the content and the
second is the channel number within that stream.  Some content will
have different streams for different languages or audio mixes.  Along
the top is each channel in the DCP.  A green box means that the
corresponding content channel will be copied into the corresponding
DCP channel.
</para>

<para>
When content channels are copied into DCP channels they can be done
with variable gain.  If, for example, you want to copy a channel
as-is, you can set a gain of 0dB.  Alternatively, if you want to mix
two channels into one, you may want to use a gain of -6dB on each one
to prevent clipping when the two channels are added.
</para>

<para>
The green boxes of the audio mapping view tell you (very roughly) how
much gain is applied to each channel.  A full-height box means 0dB
(i.e. unity) gain.  Any less height indicates lower gain.
</para>

<para>
To map one channel to another with 0dB gain, click in the empty box
and it will turn green to reflect the mapping.  A second click will
turn the mapping back off.  To set some other gain, right-click on the
box to open the gain menu.  This allows you to set
<guilabel>Off</guilabel> (no mapping or negative infinity gain),
<guilabel>Full</guilabel> (0dB gain), -6dB gain or
<guilabel>Edit</guilabel> which allows you to set the required gain
precisely.
</para>

<para>
Consider, for example, the case in <xref linkend="fig-audio-map-eg1"/>.
</para>

<figure id="fig-audio-map-eg1">
  <title>Audio map example 1</title>
  <mediaobject>
    <imageobject>
       <imagedata fileref="screenshots/audio-map-eg1&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
Here, we have two channels in the source which are mapped to left and
right, respectively, in the DCP.  The full green boxes show that the
mapping is at unity gain (0dB) in each case.  Imagine that we modify
the settings to those shown in <xref linkend="fig-audio-map-eg2"/>
</para>

<figure id="fig-audio-map-eg2">
  <title>Audio map example 2</title>
  <mediaobject>
    <imageobject>
       <imagedata fileref="screenshots/audio-map-eg2&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
We now have the content's streams mapped to left and right and also
mixed together and placed in the DCP's centre channel.  The smaller
green boxes on the centre mappings show that those channels are added
with some non-unity gain; you can see by hovering the mouse pointer
over those boxes that the gain for content channels 1 and 2 is -6dB
when being sent to the centre channel and 0dB when being sent to left
and right.
</para>

<figure id="fig-audio-map-eg3">
  <title>Audio map example 3</title>
  <mediaobject>
    <imageobject>
       <imagedata fileref="screenshots/audio-map-eg3&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
As a final example, the map in <xref linkend="fig-audio-map-eg3"/>
shows the mapping of a 5.1 source into a 5.1 DCP.
</para>

</section>


<!-- ============================================================== -->
<section>
  <title>Other controls</title>

<para>
The <guilabel>Refer to existing DCP</guilabel> checkbox isonly
applicable if the selected content is an existing DCP.  It allows you
to get the audio content from the existing DCP by referencing it
(rather than copying).  See <xref linkend="sec-overlay"/>.
</para>

<para>
<guilabel>Show graphs of audio levels</guilabel> will analyse the
audio of the selected content and plot it on a graph.  See <xref
linkend="sec-show-audio"/> for more details.
</para>

<para>
&lsquo;Audio Gain&rsquo; is used to alter the volume of the
soundtrack.  The specified gain (in dB) will be applied to each sound
channel of your content before it is written to the DCP.
</para>

<para>
If you use a sound processor that DCP-o-matic knows about, it can help
you calculate changes in gain that you should apply.  Say, for
example, that you make a test DCP and find that you have to run it at
volume 5 instead of volume 7 to get a good sound level in the screen.
If this is the case, click the <guilabel>Calculate...</guilabel>
button next to the audio gain entry, and the dialogue box in <xref
linkend="fig-calculate-audio-gain"/> will open.
</para>

<figure id="fig-calculate-audio-gain">
  <title>Calculating audio gain</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/calculate-audio-gain&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
For our example, put 5 in the first box and 7 in the second and click
<guilabel>OK</guilabel>.  DCP-o-matic will calculate the audio gain
that it should apply to make this happen.  Then you can re-make the
DCP (this will be reasonably fast, as the video data will already have
been done) and it should play back at the correct volume with 7 on
your sound-rack fader.
</para>

<para>
Current versions of DCP-o-matic only know about the Dolby CP650 and
CP750.  If you use a different sound processor, and know the gain
curve of its volume control, <ulink url="mailto:carl@dcpomatic.com">get in
touch</ulink>.
</para>

<para>
<guilabel>Audio Delay</guilabel> is used to adjust the synchronisation
between audio and video.  A positive delay will move the audio later
with respect to the video, and a negative delay will move it earlier.
</para>

</section>
</section>


<!-- ============================================================== -->
<section>
<title>Subtitles</title>

<para>
The subtitles tab contains settings related to subtitles in your
content, as shown in <xref linkend="fig-subtitles-tab"/>.
</para>

<figure id="fig-subtitles-tab">
  <title>Subtitle settings tab</title>
  <mediaobject>
    <imageobject>
       <imagedata fileref="screenshots/subtitles-tab&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
DCP-o-matic can either:
</para>

<itemizedlist>
  <listitem>Extract subtitles that are embedded in video files, or</listitem>
  <listitem>Use subtitles from SubRip (<code>.srt</code>), SubStation
  Alpha (<code>.ssa</code>) or DCP XML files.  You may find the great
  free program <ulink
  url="http://www.nikse.dk/subtitleedit/">Subtitle Edit</ulink> useful
  for creating such files.</listitem>
</itemizedlist>

<para>
Embedded subtitles are usually represented using a set of bitmaps,
especially on files that have come from DVD or BluRay.  Such subtitles
can (currently) only be &lsquo;burnt&rsquo; into the DCP (that is,
they are included in the image and not overlaid by the projector).
</para>

<para>
With SubRip, SubStation Alpha or DCP subtitles you have the choice to
either burn-in or include the subtitles as separate subtitle
&lsquo;asset&rsquo; within your DCP (in which case the projector
overlays them onto the image on playback).  The difference between
burn-in and overlay is illustrated by <xref linkend="fig-burn-in"/>
and <xref linkend="fig-discrete"/>.
</para>

<figure id="fig-burn-in">
  <title>Burnt-in subtitles</title>
  <mediaobject>
    <imageobject>
       <imagedata scale="100" fileref="diagrams/burn-in&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

<figure id="fig-discrete">
  <title>Separate subtitles</title>
  <mediaobject>
    <imageobject>
       <imagedata scale="100" fileref="diagrams/discrete&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
The advantage of separate subtitles is that the same video content can
be used for DCPs in many different languages.  This means that only a
small text file needs to be changed for each target language, rather
than a large video file.  It also means that the time-consuming video
encoding need only be done once for the project rather than once for
every language.
</para>

<para>
Select the <guilabel>Use Subtitles</guilabel> check-box to enable
the subtitles in the selected content.
</para>

<para>
Select the <guilabel>Burn subtitles into image</guilabel> check-box to
burn these subtitles into the image; if this is not ticked the
subtitles will be included separately in the DCP to be rendered by the
projector.  This check-box will always be ticked if you are using
embedded &lsquo;image&rsquo; subtitles.
</para>

<para>
The <guilabel>X Offset</guilabel> and <guilabel>Y Offset</guilabel>
controls move the subtitles around within the image.  The offsets are
expressed as a percentage of the video frame size; 100% X offset is
the entire width of the frame, and 100% Y offset is the entire height.
Hence, to move the subtitles down by half the frame height you would
use a Y offset of 50%.
</para>

<para>
The <guilabel>X Scale</guilabel> and <guilabel>Y Scale</guilabel>
controls scale the subtitles.  Scale values of 1 make the subtitles
the same size (relative to the size of the image) as they are on the
original.  Values lower than 1 make them smaller, and values higher
make them larger.  You can stretch the subtitles in either direction
by specifying different values for X and Y scale.  Subtitles from DVD
and Blu Ray sources are frequently larger (relative to the video
frame) than those typically used for DCP, so it is often useful to
scale such subtitles down using these controls.
</para>

<para>
The <guilabel>Line spacing</guilabel> control adjusts the line spacing
of the subtitles.  This only works for non-embedded (text) subtitles.
</para>

<para>
The <guilabel>Stream</guilabel> control changes the subtitle stream
that is used when the content has more than one.
</para>

<para>
If you are using non-embedded (text) subtitles you can see the
subtitle text and timings by clicking the <guilabel>View...</guilabel>
button, or specify the fonts that should be used by clicking <guilabel>Fonts...</guilabel>.
</para>

<para>
With any subtitles you can click <guilabel>Appearance...</guilabel> to
change how the subtitles look.
</para>

</section>


<!-- ============================================================== -->
<section>
<title>Timing</title>

<para>
The timing tab contains settings related to the timing of your
content, as shown in <xref linkend="fig-timing-tab-detail"/>.
</para>

<figure id="fig-timing-tab-detail">
  <title>Timing settings tab</title>
  <mediaobject>
    <imageobject>
       <imagedata fileref="screenshots/timing-tab&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
Most of the timing tab's entries are <emphasis>time-codes</emphasis>.
These are expressed as four numbers, as shown in <xref
linkend="fig-timecode"/>.
</para>

<figure id="fig-timecode">
  <title>Timecode</title>
  <mediaobject>
    <imageobject>
       <imagedata scale="100" fileref="diagrams/timecode&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
<guilabel>Position</guilabel> is the time at which this piece of
content should start within the DCP.  In most cases, this will be
<code>0:0:0:0</code> to make the content start at the beginning of the
DCP.
</para>

<para>
<guilabel>Full length</guilabel> is the length of the piece of
content.  This can only be set for still-image content: for video or
sound content, it is fixed by the nature of the content file.  If
still-image content is being used you can set the length for which it
should be displayed using this control.
</para>

<para>
<guilabel>Trim from start</guilabel> specifies the amount that should
be trimmed from the start of the content.  You can set this amount to
trim up to the current preview position by clicking <guilabel>Trim up
to current position</guilabel>.
</para>

<para>
<guilabel>Trim from end</guilabel> specifies the amount that should be
trimmed from the end of the content.  You can set this amount to trim
after the current preview position by clicking <guilabel>Trim after to
current position</guilabel>.
</para>

<para>
<guilabel>Play length</guilabel> indicates how long this piece of
content will be once the trims have been applied.  This will be equal
to the full length minus <guilabel>trim-from-start</guilabel> and minus <guilabel>trim-from-end</guilabel>.
</para>

<para>
<guilabel>Video frame rate</guilabel> specifies the frame rate for
still-image content.  It can also be used to override the detected
frame rate of other content if DCP-o-matic has got it wrong.
</para>

<para>
Each timecode control has a <guilabel>Set</guilabel> which you should
click when you have entered a new value for a timecode.  The
<guilabel>Set</guilabel> button will make DCP-o-matic take account of
any changes to the corresponding timecode.
</para>

</section>


<!-- ============================================================== -->
<section>
<title>Video processing pipeline</title>

<para>
This section gives a little more detail about how DCP-o-matic process
video as it takes it from a source and puts it into a DCP.
</para>

<para>
Consider, as a somewhat over-the-top example, that we have a 720 x 576
image which is letterboxed with 36 black pixels each at the top and
bottom, and the video content within the letterbox should be presented
in the DCP at ratio of 2.39:1 within a 1.85:1 frame (such as might
happen with a trailer).  The source image is shown in <xref
linkend="fig-pipeline1"/>.
</para>

<figure id="fig-pipeline1">
  <title>Example image to demonstrate video processing</title>
  <mediaobject>
    <imageobject>
       <imagedata scale="100" fileref="diagrams/pipeline1&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
DCP-o-matic runs through the following steps when preparing an image for a DCP:
</para>

<itemizedlist>
<listitem>Crop</listitem>
<listitem>Scale</listitem>
<listitem>Place in container</listitem>
</itemizedlist>

<para>
First, some amount of the image can be cropped.  This is almost always
used to remove black borders (letterboxing and/or pillarboxing) around
images.
</para>

<para>
In our example image, we would use 36 pixels of crop from the top and
bottom.  This would give the new image shown in <xref
linkend="fig-pipeline2"/>.
</para>

<figure id="fig-pipeline2">
  <title>Example image after cropping</title>
  <mediaobject>
    <imageobject>
       <imagedata scale="100" fileref="diagrams/pipeline2&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
The next step is to scale the image.  Since this content should be
presented in a 2.39:1 aspect ratio inside a 1.85:1 DCP we would select
<guilabel>Scope</guilabel> from the <guilabel>Scale to</guilabel>
option in the <guilabel>Video</guilabel> tab and
<guilabel>Flat</guilabel> from the <guilabel>Container</guilabel>
option in the <guilabel>DCP</guilabel> tab.
</para>

<para>The <guilabel>Scale to</guilabel> option should always be set to
the aspect ratio at which the content should be seen.  The
<guilabel>Container</guilabel> option should be set to the preset that
you want to use on the projector.  Of course, these two settings will
often be the same.
</para>

<para>
Given the scaling and container information, DCP-o-matic will look at
the DCP's container size, and then scale the source image up until one
or both of its dimensions (width, height or both) fits the size of the
container, all the while preserving the desired aspect ratio.
</para>

<para>
In our example here, the DCP's container is specified as 1.85:1 (so
that the DCP will play back correctly using the projector's
&lsquo;Flat&rsquo; preset).  At 2K, 1.85:1 is 1998 pixels by 1080.
Scaling the source up whilst preserving its 1.85:1 aspect ratio will
result in the image hitting the sides of the container first, at a
size of 1998 x 836.  This gives us a new version of the image as shown
in <xref linkend="fig-pipeline3"/>.
</para>

<figure id="fig-pipeline3">
  <title>Example image after cropping and scaling</title>
  <mediaobject>
    <imageobject>
       <imagedata scale="100" fileref="diagrams/pipeline3&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
The final step is to place the image into the DCP.  In this case,
since we have a 2.39:1 image that should be presented as a 1.85:1 DCP,
we have set the <guilabel>container</guilabel> in the
<guilabel>DCP</guilabel> tab to be Scope.  Since the content has been
scaled to 1998 x 836, and a Flat container is 1998 x 1080, there will
be some black bars at the top and bottom of the image.  DCP-o-matic
shares out this black equally, as shown in <xref
linkend="fig-pipeline3"/>.
</para>

<figure id="fig-pipeline4">
  <title>Example image in the DCP</title>
  <mediaobject>
    <imageobject>
       <imagedata scale="100" fileref="diagrams/pipeline4&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

</section>

</chapter>

<chapter xml:id="ch-dcp" xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>DCP settings</title>

<para>
This chapter describes the settings that apply to the whole DCP.  The
controls for these settings are in the <guilabel>DCP</guilabel> tab of
the main window, as shown in <xref linkend="fig-dcp-tab"/>.
</para>

<figure id="fig-dcp-tab">
  <title>DCP settings tab</title>
  <mediaobject>
    <imageobject>
       <imagedata fileref="screenshots/dcp-tab&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
The first thing here is the name.  This is generally set to the title
of the film that is being encoded.  If <guilabel>Use ISDCF
name</guilabel> is not ticked, the name that you specify will be used
as-is for the name of the DCP.  If <guilabel>Use ISDCF name</guilabel>
is ticked, the name that you enter will be used as part of a
ISDCF-compliant name.
</para>

<para>
Underneath the name field is a preview of the name that the DCP will
get.  To use a ISDCF-compliant name, tick the <guilabel>Use ISDCF
name</guilabel> check-box.  The ISDCF name will be composed using details
of your content's soundtrack, the current date and other things that
can be specified in the ISDCF name details dialogue box, which you can
open by clicking on the <guilabel>Details</guilabel> button.
</para>

<para>
If you want to take the ISDCF-compliant name that DCP-o-matic
generates and modify it, click <guilabel>Copy as name</guilabel> and
the ISDCF name will be copied into the <guilabel>Name</guilabel> box.
You can then edit it as you wish.  The DCP name should not matter (in
that it should not affect how the DCP ingests or plays) but
projectionists will appreciate it if you use the standard naming
scheme as it makes it easier to identify details of the content.
</para>

<para>
The <guilabel>Content Type</guilabel> option can be
&lsquo;feature&rsquo;, &lsquo;trailer&rsquo; or whatever; select the
required type from the drop-down list.  On some projection systems
this will affect where your content appears in the projector's server
user interface, so take care to select an appropriate type.
</para>

<para>
The <guilabel>Signed</guilabel> check-box sets whether or not the DCP
is signed.  This is rarely important; if in doubt, tick it.
</para>

<para>
The <guilabel>Encrypted</guilabel> check-box will set whether the DCP
should be encrypted or not.  If this is ticked, the DCP will require a
KDM to play back.  Encryption is discussed in <xref
linkend="ch-encryption"/>.
</para>

<para>
If you use encryption DCP-o-matic will generate a random encryption
key for you.  To specify your own key, click the
<guilabel>Edit..</guilabel> button next to the key.
</para>

<para>
The <guilabel>Reels</guilabel> and <guilabel>Reel length</guilabel>
controls specify how the DCP will be split up into
&lsquo;reels&rsquo;.  See <xref linkend="sec-reels"/> below.
</para>

<para>
The <guilabel>Standard</guilabel> option specifies which of the two
DCP standards DCP-o-matic should use.  If in doubt, use SMPTE (the
more modern of the two).
</para>

<para>
Ticking the <guilabel>Upload DCP to TMS after it is made</guilabel>
will ask DCP-o-matic to copy the finished DCP to your configured TMS (see <xref linkend="sec-prefs-tms"/>).
</para>

<para>
At the bottom of the DCP tab are a further two tabs, one each to
contain the settings for the DCP's video and audio parts.
</para>

<para>
The <guilabel>Container</guilabel> option sets the ratio of the image
in the DCP.  If this ratio is different to the ratio used for any
content, DCP-o-matic will pad the content with black.  In simple cases
this should be set to the same ratio as that for the the primary piece
of video content.  Alternatively, you might want to pillarbox a small
format into a Flat container: in this case, select the small format
for the content's ratio and &lsquo;Flat&rsquo; for the DCP.
</para>

<para>
The <guilabel>Frame Rate</guilabel> control sets the frame rate of
your DCP.  This can be a little tricky to get right.  Ideally, you
want it to be the same as the video content that you are using.  If it
is not the same, DCP-o-matic must resort to some tricks to alter your
content to fit the specified frame rate.  Frame rates are discussed in
more detail in <xref linkend="ch-frame-rates"/>.
</para>

<para>
The <guilabel>Use best</guilabel> button sets the DCP video frame rate
to what DCP-o-matic thinks is the best given the content that you have
added.
</para>

<para>
The <guilabel>3D</guilabel> button will set your DCP to 3D mode if it
is checked.  A 3D DCP will then be created, and any 2D content will be
made 3D compatible by repeating the same frame for both left and right
eyes.  A 3D DCP can be played back on many 3D systems (e.g. Dolby 3D,
Real-D etc.) but not on a 2D system.
</para>

<para>
The <guilabel>Resolution</guilabel> tab allows you to choose the
resolution for your DCP.  Use 2K unless you have content that is of
high enough resolution to be worth presenting in 4K.
</para>

<para>
The <guilabel>JPEG2000 bandwidth</guilabel>; setting changes how big
the final image files used within the DCP will be.  Larger numbers
will give better quality, but correspondingly larger DCPs.  The
bandwidth can be between 50 and 250 megabits per second (Mbit/s).
Most commercial DCPs use bit rates between 75 and 125 MBit/s.
</para>

<para>
The <guilabel>Audio Channels</guilabel> control sets the number of
audio channels that the DCP will have.  If the DCP has any channels
for which there is no content audio they will be replaced by silence.
You can only set an even number of channels here, since that is
required by the DCI standard.  If you want an odd number of channels,
set the DCP channel count to one greater than you need and the
unused channel will be filled with silence.
</para>

<para>
The <guilabel>Processor</guilabel> control allows you to select a
process to apply to the audio before it goes into the DCP.  Three processes are currently provided:
</para>

<itemizedlist>
<listitem>Mid-side decode &mdash; this will take a L/R
stereo input and extract the common part (corresponding to the
&lsquo;Mid&rsquo; in a mid-side signal) into the DCP's centre channel.
The remaining L/R parts will be kept in the L/R channels of the DCP.
This may be useful to make near-field L/R mixes more compatible with
cinema audio systems.</listitem>
<listitem>Stereo to 5.1 up-mixer A &mdash; this will take a stereo input and up-mix it to &lsquo;fake&rsquo; 5.1.  The input L/R are treated as follows:
<itemizedlist>
<listitem>DCP L is input L bandpass-filtered between 1.9kHz and 4.8kHz.</listitem>
<listitem>DCP R is input R bandpass-filtered between 1.9kHz and 4.8kHz.</listitem>
<listitem>DCP C is input L mixed with input R, taken down by 3dB and then bandpass-filtered between 150Hz and 1.9kHz.</listitem>
<listitem>DCP Lfe is input L mixed with input R, taken down by 3dB and then bandpass-filtered between 20Hz and 150Hz.</listitem>
<listitem>DCP Ls is input L bandpass-filtered between 4.8kHz and 20kHz.</listitem>
<listitem>DCP Rs is input R bandpass-filtered between 4.8kHz and 20kHz.</listitem>
</itemizedlist>
<para>
This upmixing algorithm is due to Grald Maruccia.
</para>
</listitem>
<listitem>Stereo to 5.1 up-mixer B &mdash; this uses a different approach:
<itemizedlist>
  <listitem>DCP L is input L.</listitem>
  <listitem>DCP R is input R.</listitem>
  <listitem>DCP C is input L + input R taken down by 3dB.</listitem>
  <listitem>DCP Lfe is DCP C bandpass filtered between 20Hz and 150Hz.</listitem>
  <listitem>DCP Ls and Rs are input L - input R with a 20ms delay.</listitem>
</itemizedlist>
</listitem>
</itemizedlist>

<!-- ============================================================== -->
<section xml:id="sec-reels">
<title>Reels</title>

<para>
A &lsquo;reel&rsquo; in a DCP is a subsection of the DCP, in the same
way as a 35mm reel is a section of a film.  A DCP can be split up into
any number of reels and the joins (the equivalent to 35mm splices)
between the reels are seamless.
</para>

<para>
There is no reason why you can't just use a single reel for the whole
of your DCP, as there is no limit on their length.  Many people choose
to do this.
</para>

<para>
There are, however, some possible advantages of splitting things up
into reels:
</para>

<itemizedlist>
<listitem>
The picture, sound and subtitle data of the DCP will be
split up into more smaller files on disk, rather than fewer larger
files.  This can be useful if the DCP is to be transferred on storage
that have file size limits.  The FAT32 filesystem, for example, can
only hold files smaller than 4Gb.  A 6Gb DCP with a single reel could
not be transferred using a FAT32-formatted disk.  If that DCP were
split up into two 3Gb reels it could be transferred.
</listitem>
<listitem>
It is easier to re-use DCP components if they are in reels.  Consider,
for example, a film company who wants to put a 5 second ident onto the
beginning of DCPs that they distribute.  If they receive a feature
film DCP they can modify it to add their ident as a separate reel.
This is easier than attaching the picture data in the DCP.
</listitem>
</itemizedlist>

<para>
DCP-o-matic offers three options for setting up the reels in your DCP:
single reel, split by video content or custom.
</para>

<para>
<guilabel>Single reel</guilabel>, as its name suggests, keeps the whole DCP as one reel.
This is a perfectly good option if you have no particular reason to
need reels.
</para>

<para>
<guilabel>Split by video content</guilabel> puts each piece of source
video content in its own reel, as shown in <xref linkend="fig-reels-by-video"/>.
</para>

<figure id="fig-reels-by-video">
<title>Making reels using split by video content</title>
<mediaobject><imageobject><imagedata scale="100" fileref="diagrams/reels-by-video&dia;"/></imageobject></mediaobject>
</figure>

<para>
Here we have three video files (<code>ident.mp4</code>,
<code>feature.ts</code> and <code>cred.mov</code>).  With
<guilabel>split by video content</guilabel> DCP-o-matic makes a new
reel to hold each video file.
</para>

<para>
<guilabel>Custom</guilabel> splits reels by the size of the files that
will make up their video content.  With <guilabel>Custom</guilabel>
you must specify a reel length in Gb.  Then no file in the DCP will be larger than this reel length.
</para>

</section>


<!-- ============================================================== -->
<section xml:id="sec-show-audio">
<title>Show audio</title>

<para>
The <guilabel>Show Audio</guilabel> button will instruct DCP-o-matic
to examine the audio in your content and plot a graph of its level
over time.  This can be useful for getting a rough idea of how loud
the sound will be in the cinema auditorium.  A typical plot is shown
in <xref linkend="fig-audio-plot"/>
</para>

<figure id="fig-audio-plot">
  <title>Audio plot</title>
  <mediaobject>
    <imageobject>
       <imagedata fileref="screenshots/audio-plot&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
The plot gives the audio level (vertical axis, in dB) with time
(horizontal axis).  0dB represents full scale, so if there is anything
near this you are in danger of clipping the projector's audio outputs.
</para>

<para>
There are two plot types: the peak level and the RMS, which can be
shown or hidden using the check-boxes on the right hand side of the
window.
</para>

<para>
The channel check-boxes will show or hide the plot(s) for
the corresponding channels in the DCP.
</para>

<para>
The smoothing slider applies a variable degree of temporal smoothing
to the plots, which can make them easier to read in some cases.
</para>

<para>
Obviously the audio plot is no substitute for listening in an
auditorium, but it can be useful to get levels in the right rough area.
</para>

</section>

</chapter>


<!-- ============================================================== -->
<chapter xml:id="ch-templates" xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>Templates</title>

<para>
If you frequently make DCPs with similar settings you may find it
useful to use templates.
</para>

<para>
Say, for example, you often make 4K feature DCPs from video files in
&rsquo;scope at 25fps.  You can speed up this process by following
these steps:
</para>

<itemizedlist>
  <listitem>Create a film with any content and set it up how you like;
  in our example, set the content to scale to DCP, the DCP resolution
  to 4K, and so on.</listitem>
  <listitem>Choose <guilabel>Save as template...</guilabel> from the <guilabel>File</guilabel> menu.</listitem>
  <listitem>Enter a name for your template.</listitem>
</itemizedlist>

<para>
Then in the future you can create a new film, tick the
<guilabel>Template</guilabel> box and choose your previously-saved
template.  The basic film's settings will come from your template, and
when you add some content it will take on the settings of the
first similarly-typed piece of content in your template.
</para>

</chapter>



<!-- ============================================================== -->
<chapter xml:id="ch-encryption" xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>Encryption</title>

<para>
It is not required that DCPs be encrypted, but they can be.  This
chapter discusses the basic principles of DCP encryption, and how
DCP-o-matic can create encrypted DCPs and KDMs for them.
</para>


<!-- ============================================================== -->
<section>
<title>Basics</title>

<para>
DCPs can be encrypted.  This means that the picture and sound data are
encoded in such a way that only cinemas &lsquo;approved&rsquo; by the
DCP's creators can read them.  In particular, this means copies of the
DCP can be distributed by insecure means: if an ne'er-do-well called
Mallory obtains a hard drive containing an encrypted DCP, there is no
way that he can play it.  Only those cinemas who receive a correct key
delivery message (KDM) can play the DCP.
</para>


<!-- ============================================================== -->
<section>
<title>How it works (in a nutshell)</title>

<para>
This section attempts to summarise how DCP encryption works.  You can
skip it if you like.  You may need some knowledge of encryption
methods to understand it.
</para>

<para>
We suppose that we are trying to send a DCP to
Alice's cinema without a troublemaker called Mallory being able to
watch it himself.
</para>

<para>
There are two main families of encryption techniques.  The first,
symmetric-key encryption, allows us to encode some data using some
numeric key.  After encoding, no-one can decode the data unless they
know the key.
</para>

<para>
The first step in a DCP encryption is to encode its data with some key
using symmetric-key encryption.  The encrypted DCP can then be sent
anywhere, safe in the knowledge that even if Mallory got hold of a
copy, he could not decrypt it.
</para>

<para>
Alice, however, needs to know the key so she can play the DCP in her
cinema.  A simple approach might be for us to send Alice the key.
However, if Mallory can intercept the DCP, he might also be able to
intercept our communication of the key to Alice.  Furthermore, if Alice
happened to know Mallory, she could just send him a copy of the key.
</para>

<para>
The clever bit in the process requires the use of public-key
encryption.  With this technique we can encrypt a block of data using
some &lsquo;public&rsquo; key.  That data can then only be decrypted
using a corresponding private key which is
<emphasis>different</emphasis> to the public key.  The private and
public keys form a pair which are related mathematically, but it is
extremely hard (or rather, virtually impossible) to derive the private
key from the public key.
</para>

<para>
Public-key encryption allows us to distribute the DCP's key to Alice
securely.  The manufacturer of Alice's projector generates a public
and private key.  They hide the private key deep inside the bowels of
the projector (inside an integrated circuit) where no-one can read it.
They then make the public key available to anyone who is interested.
</para>

<para>
We take our DCP's symmetric key and encrypt it using the public key of
Alice's projector.  We send the result to Alice over email (using a
format called a Key Delivery Message, or KDM).  Her projector then
decrypts our message using its private key, yielding the magic
symmetric key which can decrypt the DCP.
</para>

<para>
If is fine if Mallory intercepts our email to Alice, since the only
key which can decrypt the message is the private key buried inside
Alice's projector.  The projector manufacturer is very careful that
no-one ever finds out what this key is.  Our DCP is secure: only Alice
can play it back, since only her projector knows the key (even Alice
does not).
</para>

</section>
</section>


<!-- ============================================================== -->
<section>
<title>Encryption using DCP-o-matic</title>

<para>
There are two steps to distributing an encrypted DCP.  First, the
DCP's data must be encrypted, and secondly KDMs must be generated for
those cinemas that are allowed to play the DCP.
</para>

<para>
The first part is simple: ticking the <guilabel>Encrypted</guilabel>
box in the <guilabel>DCP</guilabel> tab will instruct DCP-o-matic to
encrypt the DCP that it makes using a random key that DCP-o-matic
generates.  The key will be written to the film's metadata file, which
should be kept secure.
</para>

<para>
A DCP that is generated with the <guilabel>Encrypted</guilabel> box
ticked will not play on any projector as-is (it will be marked as
&lsquo;locked&rsquo;, or whatever the projector manufacturer's term
is).
</para>

<para>
The second part of distributions is to generate KDMs for the cinemas
that you wish to allow to play your DCP.  There are two approaches to
this within DCP-o-matic: using the project, or using a DKDM.  These
approaches are now described in turn.
</para>

<section>
<title>Creating KDMs from a DCP-o-matic project</title>

<para>
You can create KDMs from inside a DCP-o-matic project using the
<guilabel>Make KDMs</guilabel> option on the <guilabel>Jobs</guilabel>
menu.  This will open the KDM dialogue box, as shown in <xref
linkend="fig-kdm"/>.
</para>

<figure id="fig-kdm">
  <title>KDM dialog</title>
  <mediaobject>
    <imageobject>
      <imagedata scale="40" fileref="screenshots/kdm&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
In order to generate KDMs for a particular projector, you need to know
its <emphasis>certificate</emphasis>.  These are usually made
available by the projector manufacturers as text files with a
<code>.pem</code> extension.
</para>

<para>
DCP-o-matic can store these certificates along with details of their
cinemas and screens within those cinemas.  Each screen has a
certificate for its projector (and optionally certificates for other
trusted devices, such as the sound processor).  DCP-o-matic can
generate KDMs for any screens that it knows about.
</para>

<para>
To add a cinema, click <guilabel>Add Cinema...</guilabel>.  This opens
a dialogue box into which you can enter the cinema's name, and
optionally an email address.  This email address can be used to
get DCP-o-matic to deliver KDMs via email.
</para>

<para>
Once you have added a cinema, select it by clicking on its name, then
click <guilabel>Add Screen...</guilabel>.  The resulting dialogue
allows you to enter a name for the screen and load in its certificate
from a file.  The certificate should be in SHA256 PEM format.
</para>

<para>
Alternatively, certificates for projection systems made by some
manufacturers can be downloaded from databases provided by the
manufacturer.  Currently this is supported for Doremi and Dolby
equipment.  If you are targeting a screen with equipment by one of
these manufacturers you can click <guilabel>Download</guilabel> then
enter the serial number of the server in the screen and click
<guilabel>Download</guilabel> again and, all being well, the certificate
will be fetched.
</para>

<para>
Using the download system you will need to know the serial number of
the media server in use in the screen.  Most cinema projection or
technical departments will know these serial numbers.
</para>

<para>
Note that the reliability of the manufacturers' certificate databases
cannot be guaranteed.  It is vital that KDMs are tested by the
destination cinema will in advance of show time to identify any
problems.
</para>

<para>
Once you have set up all the screens that you need KDMs for, select
the CPL that you want to create the KDM for.  You can use the
drop-down list to select the CPLs in the current film project, or load
a CPL from somewhere else.  Select the cinemas and/or screens that you
want KDMs for and fill in the start and end dates and times.
</para>

<para>
You must also select the type of KDM that you want to generate.  If in
doubt, use <guilabel>Modified Transitional 1</guilabel>.
</para>

<note>
The differences between the three KDM types are fairly subtle.
<guilabel>DCI Specific</guilabel> and <guilabel>DCI Any</guilabel> add
a <code>&lt;ContentAuthenticator&gt;</code> tag to the KDM which
allows the exhibitor to check that the DCP and KDM have come from a
bona-fide source.  In addition, <guilabel>DCI Specific</guilabel> adds
information on trusted devices to the KDM.  This allows the KDM
creator to specify devices (such as sound processors) that are allowed
to use keys delivered by the KDM.  At present it is not clear how
widely the <guilabel>DCI Specific</guilabel> and <guilabel>DCI
Any</guilabel> features are supported (or even tolerated) by servers
so you are advised to use <guilabel>Modified Transitional
1</guilabel>.
</note>

<para>
Finally, choose what you want to do with the KDMs.  They can be
written to disk, to a location that you can specify by clicking
<guilabel>Browse</guilabel>.  Alternatively, if you choose
<guilabel>Send by email</guilabel> the KDMs will be zipped up and
emailed to the appropriate cinema email addresses.  Click
<guilabel>Make KDMs</guilabel> to generate the KDMs.
</para>

</section>

<section>
<title>Creating KDMs using a DKDM</title>
</section>

<para>
It can be inconvenient to need a whole DCP-o-matic project just to
create KDMs for its film.  Perhaps you want to archive the project to
save space, or create KDMs on a different machine.  In such situations
it is easier to use a DKDM.  This is a normal KDM, but instead of
being targeted at a projection system (to allow it to decrypt the
content) it is targeted at a particular users's certificate.  This
means that the certificate owner can create new KDMs for other users.
The DKDM holds everything that is required to create further KDMs.
</para>

<para>
Sometimes it is useful to create DKDMs that can be used by
DCP-o-matic.  If you create such a DKDM you can keep it and then, at
any point in the future, use DCP-o-matic's standalone KDM creator to
make KDMs for the DKDM's film for any cinema.
</para>

<para>
In other cases a DKDM is sent to a 3rd party so that they can create
KDMs for your films.  This can be useful if, for example, you have a
distributor who provides 24-hour KDM support to cinemas and can create
KDMs for anybody that requires them at short notice.
</para>

<para>
To create a DKDM for DCP-o-matic, open your encrypted project and
select <guilabel>Make DKDM for DCP-o-matic...</guilabel> from the
<guilabel>Jobs</guilabel> menu.  Select the CPL that you want to make
the DKDM for and click <guilabel>OK</guilabel>.  This DKDM will then
be available in the KDM creator.  This is a separate program which you
can start from the same place that you start the &lsquo;normal&rsquo;
DCP-o-matic.  Its window is shown in <xref linkend="fig-kdm-creator"/>.
</para>

<figure id="fig-kdm-creator">
  <title>The KDM creator</title>
  <mediaobject>
    <imageobject>
      <imagedata scale="35" fileref="screenshots/kdm-creator&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
To create KDMs, select the cinema(s) and/or screens that you want KDMs
to be created for, the date range, the DCP that the KDMs are for and
the destination for the KDMs and click <guilabel>Create
KDMs</guilabel>.
</para>

<para>
By default the <guilabel>DKDM</guilabel> list will list any DCPs for
which you have clicked <guilabel>Make DKDM for
DCP-o-matic</guilabel>in the main DCP-o-matic program.  If you have
other DKDMs you can add them by clicking <guilabel>Add...</guilabel> and
specifying the file containing the DKDM.
</para>

<para>
If another organisation wants to send you a DKDM they will ask you for
a target certificate.  You can get DCP-o-matic's target certificate by
opening <guilabel>Preferences</guilabel> and clicking <guilabel>Export
DCP decryption certificate...</guilabel> in the <guilabel>Keys</guilabel>
tab.

</para>

</section>

<section>
<title>Encryption overview</title>

<figure id="fig-encryption-overview">
  <title>Overview of encryption</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="diagrams/crypt&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

</section>
</chapter>



<!-- ============================================================== -->
<chapter xml:id="ch-preferences" xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>Preferences</title>

<para>
DCP-o-matic provides a few preferences which can be used to modify its
behaviour.  This chapter explains those options.
</para>

<para>
Preferences can be edited by choosing
<guilabel>Preferences...</guilabel> from the <guilabel>Edit</guilabel>
menu.  This opens a dialogue which is split into seven tabs.
</para>

<!-- ============================================================== -->
<section>
<title>General</title>

<para>
The general tab is shown in <xref linkend="fig-prefs-general"/>.
</para>

<figure id="fig-prefs-general">
  <title>General preferences</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/prefs-general&scs;"/>
    </imageobject>
  </mediaobject>
</figure>


<!-- ============================================================== -->
<section>
<title>Language</title>

<para>
If you tick the <guilabel>Set Language</guilabel> checkbox and choose
a language from the list, that language will be used for DCP-o-matic.
You will need to restart DCP-o-matic to see the new language.
</para>

<para>
The translations for DCP-o-matic have been contributed by helpful
users.  If your language is not on the last, head to <ulink
url="http://dcpomatic.com/i18n.php">the DCP-o-matic website</ulink> to
read about how to contribute a translation.
</para>
</section>


<!-- ============================================================== -->
<section>
<title>Threads</title>

<para>
When DCP-o-matic is encoding DCPs it can use multiple parallel threads
to speed things up.  Set this value to the number of threads
DCP-o-matic should use.  This should normally be the number of
processors (or processor cores) in your machine.  DCP-o-matic will try
to set this up correctly when you run it for the first time.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Cinema and screen database file</title>

<para>
This option allows you to change the file that DCP-o-matic uses to
store details of the cinemas and screens used to make KDMs.
</para>

</section>

<section>
<title>Integrated loudness</title>

<para>
If <guilabel>Find integrated loudness, true peak and loudness range
when analysing audio</guilabel> is ticked, DCP-o-matic will do extra
work when analysing audio.  Leave this ticked if the extra parameters
are useful to you.  If not, untick it and audio analysis will be
faster.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Updates</title>

<para>
The <guilabel>Check for updates on startup</guilabel> option, if
enabled, will tell DCP-o-matic to check on <ulink
url="http://dcpomatic.com/">dcpomatic.com</ulink> to see if there any
newer versions of DCP-o-matic then the one you are running.  If so, a
dialogue box will open with a link to download the new version.
available
</para>

<para>
The <guilabel>Check for testing updates as well as stable
ones</guilabel> option will also check for test updates as well as
those that are formally &lsquo;released&rsquo;. This is useful if you
like to live on the bleeding edge!
</para>
</section>

<!-- ============================================================== -->
<section>
<title>Issuer and creator</title>

<para>
With these controls you can set the issuer and creator strings that
will be put into the DCPs which you create.
</para>
</section>

</section>

<!-- ============================================================== -->
<section>
<title>Defaults</title>

<para>
The defaults tab is shown in <xref linkend="fig-prefs-defaults"/>.
</para>

<figure id="fig-prefs-defaults">
  <title>Defaults preferences</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/prefs-defaults&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
The options in this tab simply allow you to set up default values for
various properties of new films.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Servers</title>

<para>
The servers tab is shown in <xref linkend="fig-prefs-servers"/>.
</para>

<figure id="fig-prefs-servers">
  <title>Servers preferences</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/prefs-servers&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
If <guilabel>Use all servers</guilabel> is ticked DCP-o-matic will
locate encoding servers automatically (see <xref
linkend="ch-servers"/>).
</para>

<para>
Instead of this (or in addition) servers can be specified explicitly.
To add a server, click <guilabel>Add...</guilabel> and enter the host
name or IP address of the server to use.
</para>

</section>


<!-- ============================================================== -->
<section xml:id="sec-prefs-keys">
<title>Keys</title>

<para>
The Keys tab (shown in <xref linkend="fig-prefs-keys"/>) holds options
related to the keys and certificates used in some parts of DCP
creation.
</para>

<figure id="fig-prefs-keys">
  <title>Keys preferences</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/prefs-keys&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
At the top of the tab is the chain of certificates that will be used
to sign DCPs and KDMs.  DCP-o-matic creates a random chain when you
first run it and if you are happy to use this chain you can ignore the
preferences.  Otherwise, you can add or remove certificates from the
chain using the <guilabel>Add...</guilabel> and
<guilabel>Remove</guilabel> buttons.
</para>

<para>
If you want DCP-o-matic to re-create the certificate chain (using new,
random certificates) click <guilabel>Re-make
certificates...</guilabel> and specify your organisation and common
names in the dialogue box that opens.
</para>

<para>
Underneath the certificate chain is the private key that corresponds
to the leaf certificate in the chain.  You can specify your own
private key by clicking <guilabel>Load...</guilabel>.  You must do
this if you change the leaf certificate, so that the leaf private key
corresponds to the public key held in the leaf certificate.
</para>

<para>
Underneath the details of the certificate chain and private key for
signing of DCPs and KDMs is a second chain and key which is used by
DCP-o-matic when you import an encrypted DCP as a piece of content.
The leaf certificate of this chain contains the public key that should
be used when targeting a KDM at DCP-o-matic.
</para>

<para>
If you want to import an encrypted DCP you will need to give the
decryption certificate to the distributor of the DCP so that they can
generate a DKDM for you.  You can save this certificate to disk by
clicking <guilabel>Export DCP decryption certificate...</guilabel>.
As with the signing chain, DCP-o-matic will create a certificate chain
and private key for you.  You can also choose to load your own
certificates and key or re-make the chain and key with new, random
values.
</para>

<para>
Clicking <guilabel>Export DCP decryption chain...</guilabel> will
export the whole certificate chain, rather than just the leaf
certificate.
</para>

</section>

<!-- ============================================================== -->
<section xml:id="sec-prefs-tms">
<title>TMS</title>
<titleabbrev xml:id="sec-prefs-tms-short">TMS preferences</titleabbrev>

<para>
The TMS tab (shown in <xref linkend="fig-prefs-tms"/>) gives some
options for specifying details about your theatre management system
(TMS).  If you do this, and your TMS accepts SSH or FTP connections,
you can upload DCPs directly from DCP-o-matic to the TMS using the
<guilabel>Send DCP to TMS</guilabel> option in the
<guilabel>Jobs</guilabel> menu.
</para>

<figure id="fig-prefs-tms">
  <title>TMS preferences</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/prefs-tms&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
<guilabel>Protocol</guilabel> should be set to SCP or FTP as
appropriate for your TMS.  We know that the Arts Alliance Media (AAM)
and the Doremi ranges uses SCP connections, and that Dolby's TMSs use
FTP.  Do let us know if you use any other type of TMS with the
<guilabel>Send DCP to TMS</guilabel> feature.
</para>

<para>
<guilabel>TMS IP address</guilabel> should be set to the IP address of
your TMS, <guilabel>TMS target path</guilabel> to the place that DCPs
should be uploaded to (which will be relative to the home directory of
the SSH or FTP user).  Finally, the user name and password are the
credentials required to log into the TMS via SSH or FTP.
</para>

<para>
Note that for this to work on Doremi servers you will need to set the
<code>PasswordAuthentication</code> option in your server's
<code>sshd_config</code> to <code>yes</code>.
</para>

</section>


<!-- ============================================================== -->
<section>
<title>KDM email</title>

<para>
The KDM email is shown in <xref linkend="fig-prefs-kdm-email"/>.
</para>

<figure id="fig-prefs-kdm-email">
  <title>KDM email preferences</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/prefs-kdm-email&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
This is a template for the email that is used to send KDMs out to
cinemas.  You can change it to say whatever you like.  A few
&lsquo;magic&rsquo; strings will be replaced by information from the
KDM that is being sent:
</para>

<table>
<title>&lsquo;Magic&rsquo; KDM strings</title>
<tgroup cols='2' align='left' colsep='1' rowsep='1'>
<tbody>
<row>
<entry><code>$CPL_NAME</code></entry><entry>DCP title</entry>
</row>
<row>
<entry><code>$CINEMA_NAME</code></entry><entry>Cinema name</entry>
</row>
<row>
<entry><code>$SCREENS</code></entry><entry>Name of screen or screens that KDMs are being generated for</entry>
</row>
<row>
<entry><code>$START_TIME</code></entry><entry>The time from which the KDMs are valid</entry>
</row>
<row>
<entry><code>$END_TIME</code></entry><entry>The time until which the KDMs are valid</entry>
</row>
</tbody>
</tgroup>
</table>

<para>
The <guilabel>Reset to default text</guilabel> will replace the current KDM email with DCP-o-matic's default.
</para>

</section>


<!-- ============================================================== -->
<section xml:id="sec-prefs-advanced">
<title>Advanced</title>
<titleabbrev xml:id="sec-prefs-advanced-short">Advanced preferences</titleabbrev>

<para>
The advanced preferences are shown in <xref linkend="fig-prefs-advanced"/>.
</para>

<figure id="fig-prefs-advanced">
  <title>Advanced preferences</title>
  <mediaobject>
    <imageobject>
      <imagedata fileref="screenshots/prefs-advanced&scs;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
<guilabel>Maximum JPEG2000 bandwidth</guilabel> specifies the maximum
bit-rate of JPEG2000 that DCP-o-matic will allow you to create.  You
are advised to leave this at 250Mbit/s in normal use for maximum DCP
compatibility.
</para>

<para>
<guilabel>Allow any DCP frame rate</guilabel> removes the limits on
the DCP video frame rates that DCP-o-matic will create.  This may be
useful for experimentation.  Again, you are strongly advised to leave
this unticked for normal use.
</para>

<para>
<guilabel>Only servers encode</guilabel> makes DCP-o-matic encode
JPEG2000 data only on encoding servers and not on the host.  We
suggest you leave this un-ticked unless you have a good reason to do otherwise.
</para>

<para>
With the filename format fields you can adjust the filenames that are
used for metadata (CPL and PKL files) and assets (MXF and subtitle
files).  Below each field there is a list of the &lsquo;magic&rsquo;
values that you can use in the format and an example of a filename
that you might see with your current settings.
</para>

<para>
The four checkboxes labelled <guilabel>Log</guilabel> control what
sort of messages DCP-o-matic writes to its log file when creating a
DCP.  It is useful to leave <guilabel>General</guilabel>,
<guilabel>Warnings</guilabel> and <guilabel>Errors</guilabel> ticked
as this makes the log files useful for tracking down bugs.
</para>

<para>
The <guilabel>Timing</guilabel> checkbox will enable extra log entries
to allow developers to investigate and optimize the speed of
DCP-o-matic.  It will significantly increase the size of the log files
that are generated, so in normal use it is best to leave this
unticked.
</para>

</section>
</chapter>

<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en" xml:id="ch-frame-rates">
<title>Frame rates</title>

<para>
In an ideal world, a DCP would be created using content at the same
video frame and audio sampling rates as the DCP.  This is not,
however, always possible.
</para>


<!-- ============================================================== -->
<section>
<title>DCP frame rate limitations</title>

<para>
There are some limitations to video and audio frame rates in DCPs.  This is
complicated by the fact that not all projectors will play DCPs at the
same frame rates.  It is possible to create a DCP which one projector will
play fine, but another (of a different type) will refuse to play, or
even refuse to ingest.
</para>


<!-- ============================================================== -->
<section>
<title>Guaranteed rates</title>

<para>
The only rates that are (pretty much) guaranteed to work on all DCI
projectors are 24 frames per second (fps) for video and 48kHz or 96kHz
for audio.  If you are sending your DCPs to unknown places it wise to
consider using these rates if at all possible.
</para>

</section>


<!-- ============================================================== -->
<section>
<title>Other often-supported rates</title>
<para>
Many projectors now in the wild support additional video frame rates:
25, 30 and 48 fps.
</para>
</section>


<!-- ============================================================== -->
<section>
<title>Adapting content to fit the DCP rate</title>

<para>
DCP-o-matic has a few tricks to allow you to use content that is not
in one of the &lsquo;approved&rsquo; rates.
</para>

<para>
Audio is easy: DCP-o-matic can resample to 48kHz from any source rate
with minimal loss in quality.
</para>

<para>
Video rate conversion is harder.  DCP-o-matic's basic strategy to deal
with a non-supported content rate is to run it at the wrong speed, and
to adjust the audio to keep it in sync.
</para>

<para>Let us consider the example of a 25fps source for which you want
to create a 24fps DCP.  DCP-o-matic will put the frames from the
source directly into the DCP without modification, but will tell the
projector to play them back at 24fps.  This means that the DCP's video
will run slightly slower than the original.
</para>

<para>
If DCP-o-matic did nothing else, the result of this would be that the
audio would be running at the original speed with the video running
slowly.  Hence the audio would drift slowly out of sync.  To avoid
this, DCP-o-matic also resamples the audio such that the projector
will play it too slow by the same amount.  Hence it will sound
slightly different but will remain in sync with the video.
</para>

<para>
For very low or high frame rates, DCP-o-matic can also skip or duplicate frames.
</para>

</section>
</section>


<!-- ============================================================== -->
<section>
<title>Setting up</title>

<para>
The <guilabel>Frame Rate</guilabel> control in the
<guilabel>DCP</guilabel> tab sets the video frame rate that the DCP
will use.  Clicking <guilabel>Use best</guilabel> sets the rate to
what DCP-o-matic thinks is the best for your content.  With this
button, DCP-o-matic assumes that the whole range of frame rates (24,
25, 30 and 48fps) are allowable.
</para>

<para>
After this, the <guilabel>Video</guilabel> tab for each piece of
content will give a summary of what DCP-o-matic is doing with that
content.
</para>

<para>
If you want to experiment with other non-standard frame rates, you can
do so by ticking the <guilabel>Allow any DCP frame rate</guilabel> in
the <guilabel>Advanced</guilabel> tab of the preferences dialogue (see the
<xref linkend="sec-prefs-advanced" endterm="sec-prefs-advanced-short"/>).  You are strongly advised to
use this only on your own equipment, and only for experimentation
purposes.
</para>

</section>

</chapter>


<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en" xml:id="ch-servers">
<title>Encoding servers</title>

<para>
One way to increase the speed of DCP encoding is to use more
than one machine at the same time.  An instance of DCP-o-matic can
offload some of the time-consuming JPEG2000 encoding to any number of
other machines on a network.  To do this, one &lsquo;master&rsquo;
machine runs DCP-o-matic, and the &lsquo;server&rsquo; machines run
a small program called <code>dcpomatic_server</code>.
</para>

<para>
The master and server machines do not need to be the same type, so you
can mix Windows PCs, Macs and Linux machines as you wish.
</para>


<!-- ============================================================== -->
<section>
<title>Running the servers</title>

<para>
There are two options for the encoding server;
<code>dcpomatic_server_cli</code>, which runs on the command line, and
<code>dcpomatic_server</code>, which has a simple GUI.  The command line
version is well-suited to headless servers, especially on Linux, and
the GUI version works best on Windows where it will put an icon in the
system tray.
</para>

<para>
To run the command line version, simply enter:
</para>

<programlisting>
dcpomatic2_server_cli
</programlisting>

<para>
at a command prompt.  If you are running the program on a machine with
a multi-core processor, you can run multiple parallel encoding threads
by doing something like:
</para>

<programlisting>
dcpomatic2_server_cli -t 4
</programlisting>

<para>
to run 4 threads in parallel.
</para>

<para>
To run the GUI version on windows, run the &lsquo;DCP-o-matic encode
server&rsquo; from the start menu.  An icon will appear in the system
tray; right-click it to open a menu from whence you can quit the
server or open a window to show its status.
</para>

<para>If you would rather not bother installing DCP-o-matic on your
server computers, the other option is to use the live-CD
image that you can download from the <ulink
url="http://dcpomatic.com/">DCP-o-matic web site.</ulink></para>

<para>Either burn the image to CD, or write it to a USB stick (using
something like <ulink
url="http://unetbootin.sourceforge.net/">unetbootin</ulink>).  Boot a
PC from the CD or USB stick and it becomes a DCP-o-matic server
without touching your standard operating system install.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Setting up DCP-o-matic</title>

<para>
DCP-o-matic periodically looks on the local network for servers.  Any
that it finds are given work to do during encodes.  Selecting
<guilabel>Encoding Servers</guilabel> from the
<guilabel>Tools</guilabel> menu brings up a window which shows that
servers that DCP-o-matic has found.
</para>

</section>

<!-- ============================================================== -->
<section>
<title>Some notes about encode servers</title>

<para>
DCP-o-matic does not mind if servers come and go; if a server
disappears, DCP-o-matic will stop sending work to it, and will check
it every minute or so in case it has come back online.
</para>

<para>
You will probably find that using a 1Gb/s or faster network will
provide a significant speed-up compared to a 100Mb/s network.
</para>

</section>

</chapter>

<chapter xml:id="ch-files" xmlns="http://docbook.org/ns/docbook" version="5.0" xml:lang="en">
<title>Generated files</title>

<para>
DCP-o-matic generates a number of files as it makes a DCP.  <xref
linkend="fig-file-structure"/> shows the files that might be generated
after you have created a DCP for a film called &lsquo;DCP Test&rsquo;.
</para>

<figure id="fig-file-structure">
  <title>Creating a new film</title>
  <mediaobject>
    <imageobject>
      <imagedata scale="100" fileref="diagrams/file-structure&dia;"/>
    </imageobject>
  </mediaobject>
</figure>

<para>
The <code>DCP Test</code> folder is the one that you specify when you
select the <guilabel>New Film</guilabel> option from DCP-o-matic's
menu.  Everything is stored inside this folder.
</para>

<para>
DCP-o-matic generates some working files as it goes along.  These are as follows:
<itemizedlist>

<listitem><code>log</code> is a list of notes that DCP-o-matic makes as it goes
along.  This can be useful for debugging purposes if something goes
wrong.</listitem>

<listitem><code>metadata</code> stores the settings that you have made
for this film: things like cropping, output format and so on.</listitem>

<listitem><code>video</code> is where DCP-o-matic writes the DCP's
video data as it encodes it.</listitem>

<listitem><code>analysis</code> is used to keep the results of audio analysis runs.</listitem>

<listitem><code>info</code> contains details of each video frame that
DCP-o-matic has written so far.  This is used when an encoding
operation is interrupted and DCP-o-matic must resume it.</listitem>
</itemizedlist>
</para>

<para>
Following this is the DCP itself:
<code>DCP-TEST_EN-XX_UK-U_51_2K_CSY_20130218_CSY_OV</code>.  This
contains some small XML files, which describe the DCP, and two large
MXF files, which contain the DCP's audio and video data.  It may also
contain subtitles in either XML or MXF format.  This folder
(<code>DCP-TEST_EN-XX_...</code>) is what you should ingest, or pass
to the cinema which is showing your DCP.
</para>

</chapter>

<chapter>
<title>Loose ends</title>

<para>
This chapter collects a few notes on bits of DCP-o-matic that do not fit elsewhere in the manual.
</para>


<!-- ============================================================== -->
<section>
<title>Resuming encodes</title>

<para>
If you cancel a DCP encoding run half-way through, or your computer
crashes... fear not.  DCP-o-matic takes care to ensure that, in most
cases, it can resume encoding from where it left off.  When you
re-start a DCP creation, using the same settings are a previous run,
DCP-o-matic will first check that the existing picture frames are
correct, and then resume from where it left off.  The checking of
existing frames does take some time, but it is much faster than
running a full re-encode.
</para>

<para>
This resumption is achieved by writing a digest (hash) to disk for
every image frame that is written.  On resumption, the existing MXF
file for image data is read and its contents checked against the
hashes.
</para>

</section>

</chapter>

</book>
