<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="common.css">
<script>

setInterval(function() {
	status = fetch("/api/v1/status").then(response => {
		response.json().then(data => {
			if (data.playing) {
				document.getElementById('playing').innerHTML = "Playing";
			} else {
				document.getElementById('playing').innerHTML = "Stopped";
			}
			document.getElementById('dcp_name').innerHTML = data.dcp_name;
			document.getElementById('position').innerHTML = data.position;
		});
	});
}, 250);
function play() {
	fetch("/api/v1/play", { method: "POST" });
}
function stop() {
	fetch("/api/v1/stop", { method: "POST" });
}

// Fetch all playlists and put them in the shared content/playlists div
function showPlaylists()
{
	var div = document.getElementById('content-and-playlists-inner');
	if (div) {
		div.innerHTML = "";
	}

	fetch("/api/v1/playlists").then(response => {
		response.json().then(data => {
			data.forEach(playlist => {
				var li = document.createElement("li");
				li.classList.add("playlist");
				li.appendChild(document.createTextNode(playlist.name));
				li.uuid = playlist['uuid'];
				li.onclick = function() {
					fetch("/api/v1/playlist/" + playlist['uuid']).then(response => {
						response.json().then(data => {
							var nextPlaylist = document.getElementById('next-playlist');
							nextPlaylist.innerHTML = "";
							var ul = document.createElement("ul");
							nextPlaylist.appendChild(ul);
							data.content.forEach(content => {
								var li = document.createElement("li");
								li.appendChild(document.createTextNode(content.name));
								ul.appendChild(li);
							});
							console.log(data);
						})
					});
				};
				document.getElementById('content-and-playlists-inner').appendChild(li);
			});

			document.getElementById('playlists-tab').classList.add('selected');
			document.getElementById('content-tab').classList.remove('selected');
		});
	});
}

function showContent()
{
	var div = document.getElementById('content-and-playlists-inner');
	if (div) {
		div.innerHTML = "";
	}

	fetch("/api/v1/content").then(response => {
		response.json().then(data => {
			data.forEach(content => {
				var li = document.createElement("li");
				li.classList.add("playlist");
				li.appendChild(document.createTextNode(content.name));
				document.getElementById('content-and-playlists-inner').appendChild(li);

				document.getElementById('content-tab').classList.add('selected');
				document.getElementById('playlists-tab').classList.remove('selected');
			});
		});
	})
}

showPlaylists();
</script>

<style>
table {
	border-collapse: collapse;
	margin: 25px 0;
	font-size: 0.9em;
	box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
	border: 2px solid black;
}

tr {
	text-align: left;
	border: 1px solid black;
}

td {
	padding: 4px 16px;
	text-align: left;
	border: 1px solid black;
}

div.tab {
	padding: 6px;
	border: 0.5px solid black;
	background-color: #eeeeee;
	width: fit-content;
	display: inline-block;
	cursor: pointer;
	margin: 2px;
}

div.tab.selected {
	background-color: #cccccc;
}

li.playlist {
	border: 1px solid black;
	background-color: #a7bad9;
	padding: 3px;
	list-style-type: none;
	cursor: pointer;
}

li.playlist.selected {
	background-color: #d343e0;
	cursor: pointer;
}

</style>

<title>TITLE</title>

</head>
<body>

SIDEBAR

<div style="margin-left: 15%;">

<div id="controls" style="float: left; width: 20%;">
	<button name="play" value="play" onclick="play()">Play</button>
	<button name="stop" value="stop" onclick="stop()">Stop</button>
	<table>
		<tr><td>DCP</td><td><p id="dcp_name"></td></tr>
		<tr><td>State</td><td><p id="playing"></td></tr>
		<tr><td>Position</td><td><p id="position"></td></tr>
	</table>
</div>

<div style="float: right; width: 70%;">

<div style="float: right; width: 100%;">
Next playlist:
<div id="next-playlist" style="width: 100%; height: 40vh;">
</div>
</div>

<div style="float: right; width: 100%; margin-top: 4em;">
Current playlist:
<div id="current-playlist" style="width: 100%; height: 10vh;">
</div>
</div>

</div>

<div id="content-and-playlists" style="float: left; width: 20%; left-margin: 10%;">
<div id="playlists-tab" onclick="showPlaylists();" class="tab selected">Playlists</div>
<div id="content-tab" onclick="showContent();" class="tab">Content</div>
<div id="content-and-playlists-inner" style="margin-top: 5pt; margin-bottom: 5pt;"></div>
</div>

</div>

</body>
</html>
